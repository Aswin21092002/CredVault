<!DOCTYPE html>
<html lang="zxx">

<head>
    <!-- meta tag -->
    {% load static %}
    <meta charset="utf-8" />
    <meta name="description" content="" />
    <!-- responsive tag -->
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- favicon -->
    <script defer src="https://js.stripe.com/v3/"></script>
    <!-- new -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <link rel="shortcut icon" type="image/x-icon" href="{% static 'bank/assets/images/Favicon Transparent.ico' %}" />
    <!-- Bootstrap v4.4.1 css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/bootstrap.min.css' %}" />
    <!-- font-awesome css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/font-awesome.min.css' %}" />
    <!-- animate css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/animate.css' %}" />
    <!-- aos css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/aos.css' %}" />
    <!-- owl.carousel css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/owl.carousel.css' %}" />
    <!-- slick css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/slick.css' %}" />
    <!-- off canvas css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/off-canvas.css' %}" />
    <!-- linea-font css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/fonts/linea-fonts.css' %}" />
    <!-- flaticon css  -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/fonts/flaticon.css' %}" />
    <!-- magnific popup css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/magnific-popup.css' %}" />
    <!-- Main Menu css -->
    <link rel="stylesheet" href="{% static 'bank/assets/css/rsmenu-main.css' %}" />
    <!-- nivo slider CSS -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/inc/custom-slider/css/nivo-slider.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/inc/custom-slider/css/preview.css' %}" />
    <!-- rsmenu transitions css -->
    <link rel="stylesheet" href="{% static 'bank/assets/css/rsmenu-transitions.css' %}" />
    <!-- spacing css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/rs-spacing.css' %}" />
    <!-- style css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/style.css' %}" />
    <!-- This stylesheet dynamically changed from style.less -->
    <!-- responsive css -->
    <link rel="stylesheet" type="text/css" href="{% static 'bank/assets/css/responsive.css' %}" />
    <script src="https://js.stripe.com/v3/"></script>
    <!-- new -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <!-- rest of the html  -->
    <title>Report on {{report.business_name.title}}</title>

    <style>
        h2 {
            padding: 0;
            margin: 0;
        }

        p {
            padding: 0;
            margin: 0;
        }

        strong {
            padding: 0;
            margin: 0;
            color: black;
        }

        * {
            color: black;
        }

        body {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;

        }

        main {
            text-align: center;
        }
    </style>

    <!-- jsPDF  -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>





</head>

<body>
    <main>
        {% if report is not None %}

        <div id="reportttt">
            <div style="
        display: flex; 
        align-items: center; 
        justify-content: space-between;
        padding: 15px;
        margin-top: 35px;
        ">
                <strong style="font-size: 25px;">Report on {{report.business_name.title}}</strong>
                <button class="btn btn-success" onclick="DownloadTheReportInPDFFormat()">Click here to download this
                    report</button>
            </div>



            <div id="report" style="
        width:800px; 
        
        box-shadow: 0px 0px 12px 0px rgba(0, 0, 0, 0.1);
        background: white;
        border-radius: 12px;
        padding:20px
        
        ">
                <div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div style="padding-bottom: 10px; padding-top: 10px;">
                            <h2 style="text-align: left;">{{report.business_name.title}}</h2>
                            <p style="text-align: left;"><strong>Address:</strong> {{report.business_address}}</p>
                        </div>
                        <div class="logo">
                            <img width="70px" src="{% static 'bank/assets/images/Favicon Transparent.ico' %}" alt="">
                        </div>
                    </div>

                    <div
                        style="display: flex; align-items: center; justify-content: space-between; margin-top: 10px;display: flex; width: 100%;  text-align: left; border: 1px solid #EAEAEA; padding: 10px; padding-left: 5px; padding-right: 5px;">
                        <p><strong>Sendesta number:</strong>&nbsp;{{report.sendesta_number}}&nbsp;</p>
                        <p><strong>Email:</strong>&nbsp;{{report.email}}&nbsp;</p>
                        <p><strong>Phone:</strong>&nbsp;{{report.telephone}}&nbsp;</p>
                    </div>

                    <div
                        style="display: flex; align-items: center; justify-content: space-around; padding-top: 20px; text-align: left;">
                        <div style="margin:20px; padding:10px; width: 320px; height: 235px; border:1px solid #EAEAEA">
                            <p style="padding:5px"><strong>Name of
                                    principal(s):</strong>&nbsp;{{report.name_of_principle.title}}&nbsp;</p>
                            <p style="padding:5px"><strong>Employees:</strong>&nbsp;{{report.company_events}}&nbsp;</p>
                            <p style="padding:5px"><strong>Age:</strong>&nbsp;{{report.age}}&nbsp;</p>
                            <p style="padding:5px"><strong>Business form:</strong>&nbsp;{{report.business_form}}&nbsp;
                            </p>
                            <p style="padding:5px"><strong>Special events:</strong>&nbsp;{{report.special_events}}&nbsp;
                            </p>
                            <p style="padding:5px"><strong>Company events:</strong>&nbsp;{{report.company_events}}&nbsp;
                            </p>
                        </div>
                        <div style="margin:20px; padding:10px; width: 320px; height: 235px; border:1px solid #EAEAEA">

                            <p style="padding:5px"><strong>Judgements:</strong>&nbsp;{{report.judgements}}&nbsp;</p>
                            <p style="padding:5px"><strong>Liens:</strong>&nbsp;{{report.liens}}&nbsp;</p>
                            <p style="padding:5px"><strong>Suits:</strong>&nbsp;{{report.suits}}&nbsp;</p>
                            <p style="padding:5px"><strong>Ucc filings:</strong>&nbsp;{{report.ucc_filings}}&nbsp;</p>
                            <p style="padding:5px"><strong>Total number of
                                    enquiries:</strong>&nbsp;{{report.total_number_of_enquiries}}&nbsp;</p>
                        </div>
                    </div>

                    <div style="border:1px solid #EAEAEA; margin:20px; padding:10px">
                        <p><strong>Annual sales:</strong>&nbsp;{{report.anual_sales}}&nbsp;</p>
                        <p><strong>Profit and loss:</strong>&nbsp;{{report.profit_and_loss}}&nbsp;</p>
                    </div>
                    <div style="display: flex;  justify-content: space-around;  text-align: left;">

                        <div style="margin:20px; padding:10px; width: 320px;  border:1px solid #EAEAEA">
                            <strong style="font-size: 25px;">Tradeline(s)</strong>
                            <hr />
                            {% for trade_line in trade_lines %}
                            <p><strong>Business name: </strong>&nbsp;{{trade_line.business_name}}&nbsp;</p>
                            <p><strong>Email: </strong>&nbsp;{{trade_line.email}}&nbsp;</p>
                            <p><strong>Phone: </strong>&nbsp;{{trade_line.phone}}&nbsp;</p>
                            <p><strong>Tradeline age: </strong>&nbsp;{{trade_line.tradeline_age}}&nbsp;</p>
                            <p><strong>Tradeline date: </strong>&nbsp;{{trade_line.tradeline_date}}&nbsp;</p>
                            <p><strong>Tradeline amount: </strong>&nbsp;{{trade_line.tradeline_amount}}&nbsp;</p>
                            <p><strong>Status: </strong>&nbsp;{{trade_line.status}}&nbsp;</p>
                            <hr />

                            {% endfor %}
                        </div>
                        <div style="margin:20px; padding:10px; width: 320px;  border:1px solid #EAEAEA">
                            <strong style="font-size: 25px;">Credit Recommendation</strong>
                            <hr />
                            {% for maximum_credit_recommendation in maximum_credit_recommendations %}
                            <p><strong>Score: </strong>&nbsp;{{maximum_credit_recommendation.score}}&nbsp;</p>
                            <p><strong>Maximum credit recommendation:
                                </strong>&nbsp;{{maximum_credit_recommendation.maximum_credit_recommendation}}&nbsp;</p>
                            <hr />
                            {% endfor %}
                        </div>

                    </div>
                </div>
            </div>
        </div>
        {% else %}
        <h1>Report hasn't been purchased!</h1>
        <p>Sorry you haven't purchased the report. Please visit the <a href="/">home</a> page and fill the form there
            to go through the checkout process</p>
    </main>

    {% endif %}
    {{ report|json_script:"serializedData" }};
    <script defer>
        function DownloadTheReportInPDFFormat() {
            let elementHTML = document.getElementById("report");
            elementHTML.style.boxShadow = 'none';
            elementHTML.style.border = 'none';
            var elementWidth = elementHTML.offsetWidth;
            var elementHeight = elementHTML.offsetHeight;

            window.jsPDF = window.jspdf.jsPDF;

            var doc = new jsPDF("p", "mm", [elementWidth, elementHeight]);
            html2canvas(elementHTML, { scale: 300 / 96 }).then(function (canvas) {
                // Convert the canvas to a data URL
                var imgData = canvas.toDataURL("image/png");

                // Add the image to the PDF document
                doc.addImage(imgData, "PNG", 0, 0, elementWidth, elementHeight);

                // Save or display the PDF
                var pdfOutput = doc.output('blob');  // Get the PDF as a Blob

                // Create a FormData object to send the PDF to the server
                var formData = new FormData();
                formData.append('pdf', pdfOutput, 'Report on {{report.business_name.title}}.pdf');
                formData.append('csrfmiddlewaretoken', '{{ csrf_token }}');  // Add CSRF token for Django

                // Send the PDF to the server via AJAX
                fetch('/save-report/', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Report saved successfully.');
                    } else {
                        console.error('Failed to save the report.');
                    }
                })
                .catch(error => console.error('Error:', error));

                // Save the PDF locally
                doc.save('Report on {{report.business_name.title}}.pdf');
            });
        }
    </script>


</body>

</html>